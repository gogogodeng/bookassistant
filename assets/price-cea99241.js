import{_ as U,o as a,c as h,a as n,F as f,r as k,d as m,w as c,e as v,v as b,t as y}from"./index-f252f49e.js";function g(){function t(){return((1+Math.random())*65536|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}const C={data(){return{message:"",books:[{guid:g(),url:"https://u.dangdang.com/qDztD",pid:"",title:"三岛由纪夫套装",price:200,original_price:300,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/m5xfH",pid:"",title:"关于女儿",price:30,original_price:49,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/XmZEC",pid:"",title:"诅咒兔（与诺奖得主托卡尔丘克一同入围2022年国际布克奖！）",price:30,original_price:60,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/XmZEC",pid:"",title:"翦商",price:49,original_price:99,pr:"",total:void 0}],options:[{guid:g(),max:300,dis:50,checked:!1},{guid:g(),max:200,dis:30,checked:!1}],evr:!0,evrV:{max:100,dis:50},curMoney:300,curNum:5,combo:[]}},computed:{booksTotal(){return this.books.length?this.books.reduce((t,e)=>t+e.price,0):0},maxValue(){let t=this.options.filter(i=>i.checked===!0),e,p,u;return t.length?(e=this.booksTotal,p=t.reduce((i,r)=>e<r.max?0:i+r.dis,0)):(e=this.booksTotal,p=0),u=this.evr?Math.floor(e/this.evrV.max)*this.evrV.dis:0,{max:e,sum:p,evrsum:u,total:e-p-u}}},methods:{addbook(){this.books.push({guid:g(),url:"",title:"",price:"",original_price:"",pr:""})},removebook(t){this.books=this.books.filter(e=>e.guid!=t)},clear(){this.books=[]},search(){localStorage.setItem("books",JSON.stringify(this.books))},getCombo(){let t=this.findCombinations(this.books.map(e=>(e.money=+e.price,e.name=e.title,e)),this.curMoney,this.curNum);console.log(t),this.calcAll(),this.combo=t.map(e=>{let p=this.filterObjectsById(this.books,e.guid);return{items:p,prTotal:p.length?p.reduce((u,i)=>u+ +i.total,0).toFixed(2):0,money:e.money}})},filterObjectsById(t,e){return t.filter(p=>e.includes(p.guid))},findCombinations(t,e,p=5){let u=[],i=[];const r=(o,s)=>{if(!(s>e+50||i.length>p)){if(s>e&&s<=e+50){u.push({guid:[...i],money:s});return}for(let l=o;l<t.length;l++)i.includes(t[l].guid)||(i.push(t[l].guid),r(l+1,s+t[l].money),i.pop())}};return r(0,0),u.sort((o,s)=>{const l=Math.abs(o.money-e),d=Math.abs(s.money-e);return l-d}),u.splice(0,p)},findCombinations2(t,e,p=5){const u=new Array(t.length+1);for(let l=0;l<=t.length;l++)u[l]=new Array(e+1).fill(Number.MAX_SAFE_INTEGER);u[0][0]=0;const i=new Array(t.length+1);for(let l=0;l<=t.length;l++)i[l]=new Array(e+1).fill(-1);for(let l=1;l<=t.length;l++)for(let d=0;d<=e;d++)d>=t[l-1].money&&u[l-1][d-t[l-1].money]!==Number.MAX_SAFE_INTEGER&&u[l-1][d-t[l-1].money]+t[l-1].money-d<u[l][d]-e&&(u[l][d]=u[l-1][d-t[l-1].money]+t[l-1].money,i[l][d]=l-1),u[l-1][d]!==Number.MAX_SAFE_INTEGER&&u[l-1][d]-d<u[l][d]-e&&(u[l][d]=u[l-1][d],i[l][d]=i[l-1][d]);let r=e;const o=[],s=new Set;for(let l=0;l<p&&i[t.length][r]!==-1;l++){const d=[];let _=i[t.length][r];for(;_>=0;)d.push(t[_].guid),r-=t[_].money,_=i[_][r];const x=d.join(",");s.has(x)||(s.add(x),o.push({guid:[...d].reverse(),name:d.map(V=>t.find(w=>w.guid===V).name).join("#"),money:u[t.length][e]-r})),r=u[t.length][e]-r}return o},calcAll(){this.books.map(t=>{let e=this.maxValue.total/this.maxValue.max*t.price;t.total=e.toFixed(2),t.pr=(e/t.original_price).toFixed(2)*100})}},mounted(){localStorage.getItem("books")&&(this.books=JSON.parse(localStorage.getItem("books")))}},N=n("div",null," 一键抄作业：活动开始前手动录入购物车书名和价格，输入凑单金额，自动计算出符合的凑单组合，然后照着抄吧。 ",-1),A=n("hr",null,null,-1),M=n("tr",null,[n("td",{style:{width:"300px"}},"书名"),n("td",{style:{width:"100px"}},"现价"),n("td",{style:{width:"100px"}},"原价")],-1),E=["onUpdate:modelValue"],S=["onUpdate:modelValue"],T=["onUpdate:modelValue"],F={style:{position:"relative"}},I=["onClick"],j=n("br",null,null,-1),B=n("hr",null,null,-1),D=n("div",null,"折扣选择",-1),X=n("br",null,null,-1),O={style:{display:"flex","align-items":"center"}},G={style:{width:"300px","text-align":"right"}},R=["onUpdate:modelValue"],J={style:{width:"300px","text-align":"right"}},Z=["onUpdate:modelValue"],q=["onUpdate:modelValue"],z=n("hr",null,null,-1),H=n("br",null,null,-1),L=n("br",null,null,-1),K=n("strong",null,"备注：目前算法按排列顺序设置优先级，尽量把最想要的书放前面",-1),P=n("hr",null,null,-1);function Q(t,e,p,u,i,r){return a(),h("div",null,[N,A,n("table",null,[M,(a(!0),h(f,null,k(i.books,o=>(a(),h("tr",{key:o.guid},[n("td",null,[c(n("input",{type:"text","onUpdate:modelValue":s=>o.title=s,style:{"max-width":"90%",width:"90%"}},null,8,E),[[b,o.title]])]),n("td",null,[c(n("input",{type:"number","onUpdate:modelValue":s=>o.price=s,style:{"max-width":"70%",width:"70%"}},null,8,S),[[b,o.price]])]),n("td",null,[c(n("input",{type:"number","onUpdate:modelValue":s=>o.original_price=s,style:{"max-width":"70%",width:"70%"}},null,8,T),[[b,o.original_price]])]),n("td",F,[n("span",{onClick:s=>r.removebook(o.guid),style:{position:"absolute",right:"0",top:"0",cursor:"pointer",color:"red"}},"×",8,I)])]))),128))]),j,n("button",{onClick:e[0]||(e[0]=(...o)=>r.addbook&&r.addbook(...o))},"添加"),m("      "),n("button",{onClick:e[1]||(e[1]=(...o)=>r.search&&r.search(...o))},"暂存"),m("      "),n("button",{onClick:e[2]||(e[2]=(...o)=>r.clear&&r.clear(...o))},"清空"),B,n("div",null,[D,X,n("div",null,[n("label",O,[c(n("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=o=>i.evr=o)},null,512),[[v,i.evr]]),n("div",G,[m(" 每满 "),c(n("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=o=>i.evrV.max=o)},null,512),[[b,i.evrV.max]]),m(" 减 "),c(n("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=o=>i.evrV.dis=o)},null,512),[[b,i.evrV.dis]])])])]),n("div",null,[(a(!0),h(f,null,k(i.options,o=>(a(),h("label",{style:{display:"flex","align-items":"center"},key:o.guid},[c(n("input",{type:"checkbox","onUpdate:modelValue":s=>o.checked=s},null,8,R),[[v,o.checked]]),n("div",J,[m(" 满 "),c(n("input",{type:"number","onUpdate:modelValue":s=>o.max=s},null,8,Z),[[b,o.max]]),m(" 减 "),c(n("input",{type:"number","onUpdate:modelValue":s=>o.dis=s},null,8,q),[[b,o.dis]])])]))),128))])]),z,H,m(" 凑单金额 "),c(n("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=o=>i.curMoney=o)},null,512),[[b,i.curMoney]]),m(" 显示 "),c(n("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=o=>i.curNum=o)},null,512),[[b,i.curNum]]),m(" 个结果 "),n("button",{onClick:e[8]||(e[8]=(...o)=>r.getCombo&&r.getCombo(...o))},"计算凑单组合"),L,K,P,n("div",null,[(a(!0),h(f,null,k(i.combo,(o,s)=>(a(),h("ul",{key:s},[n("li",null,"组合"+y(s+1)+"：",1),(a(!0),h(f,null,k(o.items,l=>(a(),h("li",{key:l}," [优惠后"+y(l.total)+"元，折扣率"+y(l.pr)+"%] 【"+y(l.title)+"】 ",1))),128)),n("li",null,"总价：[优惠后"+y(o.prTotal)+"元] 原价 "+y(o.money)+" 元",1)]))),128))])])}const Y=U(C,[["render",Q]]);export{Y as default};
