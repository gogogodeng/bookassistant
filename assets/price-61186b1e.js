import{_ as U,o as h,c as a,a as n,F as _,r as k,d as m,w as c,e as x,v as b,t as f}from"./index-e4bfa1e7.js";function g(){function t(){return((1+Math.random())*65536|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}const A={data(){return{message:"",books:[{guid:g(),url:"https://u.dangdang.com/qDztD",pid:"",title:"三岛由纪夫套装",price:200,original_price:300,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/m5xfH",pid:"",title:"关于女儿",price:30,original_price:49,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/XmZEC",pid:"",title:"诅咒兔（与诺奖得主托卡尔丘克一同入围2022年国际布克奖！）",price:30,original_price:60,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/XmZEC",pid:"",title:"翦商",price:49,original_price:99,pr:"",total:void 0}],options:[{guid:g(),max:300,dis:50,checked:!1},{guid:g(),max:200,dis:30,checked:!1}],evr:!0,evrV:{max:100,dis:50},curMoney:300,curNum:5,combo:[]}},computed:{booksTotal(){return this.books.length?this.books.reduce((t,e)=>t+e.price,0):0},maxValue(){let t=this.options.filter(i=>i.checked===!0),e,u,s;return t.length?(e=this.booksTotal,u=t.reduce((i,r)=>e<r.max?0:i+r.dis,0)):(e=this.booksTotal,u=0),s=this.evr?Math.floor(e/this.evrV.max)*this.evrV.dis:0,{max:e,sum:u,evrsum:s,total:e-u-s}}},methods:{addbook(){this.books.push({guid:g(),url:"",title:"",price:"",original_price:"",pr:""})},removebook(t){var e=confirm("你确定要删除吗？");e&&(this.books=this.books.filter(u=>u.guid!=t))},clear(){this.books=[]},swapArrayElements(t,e,u){if(e<0||e>=t.length||u<0||u>=t.length)return;const s=t[e];t[e]=t[u],t[u]=s},search(){localStorage.setItem("books",JSON.stringify(this.books))},getCombo(){let t=this.findCombinations(this.books.map(e=>(e.money=+e.price,e.name=e.title,e)),this.curMoney,this.curNum);console.log(t),this.calcAll(),this.combo=t.map(e=>{let u=this.filterObjectsById(this.books,e.guid);return{items:u,prTotal:u.length?u.reduce((s,i)=>s+ +i.total,0).toFixed(2):0,money:e.money}})},filterObjectsById(t,e){return t.filter(u=>e.includes(u.guid))},findObjectsByIds(t,e){return t.filter(function(u){var s=e.every(function(i){return u.guid.indexOf(i)!==-1});return s})},findCombinations(t,e,u=5){let s=[],i=[];const r=(o,p)=>{if(!(p>e+10||i.length>u)){if(p>e&&p<=e+10){s.push({guid:[...i],money:p});return}for(let l=o;l<t.length;l++)i.includes(t[l].guid)||(i.push(t[l].guid),r(l+1,p+t[l].money),i.pop())}};return r(0,0),s.sort((o,p)=>{const l=Math.abs(o.money-e),d=Math.abs(p.money-e);return l-d}),s=this.findObjectsByIds(s,this.books.filter(o=>!!o.lock).map(o=>o.guid)),s.splice(0,u)},findCombinations2(t,e,u=5){const s=new Array(t.length+1);for(let l=0;l<=t.length;l++)s[l]=new Array(e+1).fill(Number.MAX_SAFE_INTEGER);s[0][0]=0;const i=new Array(t.length+1);for(let l=0;l<=t.length;l++)i[l]=new Array(e+1).fill(-1);for(let l=1;l<=t.length;l++)for(let d=0;d<=e;d++)d>=t[l-1].money&&s[l-1][d-t[l-1].money]!==Number.MAX_SAFE_INTEGER&&s[l-1][d-t[l-1].money]+t[l-1].money-d<s[l][d]-e&&(s[l][d]=s[l-1][d-t[l-1].money]+t[l-1].money,i[l][d]=l-1),s[l-1][d]!==Number.MAX_SAFE_INTEGER&&s[l-1][d]-d<s[l][d]-e&&(s[l][d]=s[l-1][d],i[l][d]=i[l-1][d]);let r=e;const o=[],p=new Set;for(let l=0;l<u&&i[t.length][r]!==-1;l++){const d=[];let y=i[t.length][r];for(;y>=0;)d.push(t[y].guid),r-=t[y].money,y=i[y][r];const v=d.join(",");p.has(v)||(p.add(v),o.push({guid:[...d].reverse(),name:d.map(V=>t.find(w=>w.guid===V).name).join("#"),money:s[t.length][e]-r})),r=s[t.length][e]-r}return o},calcAll(){this.books.map(t=>{let e=this.maxValue.total/this.maxValue.max*t.price;t.total=e.toFixed(2),t.pr=(e/t.original_price*100).toFixed(2)})}},mounted(){localStorage.getItem("books")&&(this.books=JSON.parse(localStorage.getItem("books")))}},C=n("div",null," 一键抄作业：活动开始前手动录入购物车书名和价格，输入凑单金额，自动计算出符合的凑单组合，然后照着抄吧。 ",-1),N=n("hr",null,null,-1),E=n("tr",null,[n("td",{style:{width:"200px"}},"书名"),n("td",{style:{width:"100px"}},"现价"),n("td",{style:{width:"100px"}},"原价"),n("td",{style:{width:"100px"}},"锁定")],-1),M=["onUpdate:modelValue"],S=["onUpdate:modelValue"],I=["onUpdate:modelValue"],T=["onUpdate:modelValue"],j={style:{position:"relative"}},B=["onClick"],F=n("br",null,null,-1),O=n("hr",null,null,-1),D=n("div",null,"折扣选择",-1),X=n("br",null,null,-1),G={style:{display:"flex","align-items":"center"}},R={style:{width:"300px","text-align":"right"}},J=["onUpdate:modelValue"],Z={style:{width:"300px","text-align":"right"}},q=["onUpdate:modelValue"],z=["onUpdate:modelValue"],H=n("hr",null,null,-1),L=n("br",null,null,-1),K=n("br",null,null,-1),P=n("strong",null,"备注：算法默认按排列顺序计算优先级，可以锁定想要的书",-1),Q=n("hr",null,null,-1);function W(t,e,u,s,i,r){return h(),a("div",null,[C,N,n("table",null,[E,(h(!0),a(_,null,k(i.books,(o,p)=>(h(),a("tr",{key:o.guid},[n("td",null,[c(n("input",{type:"text","onUpdate:modelValue":l=>o.title=l,style:{"max-width":"90%",width:"90%"}},null,8,M),[[b,o.title]])]),n("td",null,[c(n("input",{type:"number","onUpdate:modelValue":l=>o.price=l,style:{"max-width":"70%",width:"70%"}},null,8,S),[[b,o.price]])]),n("td",null,[c(n("input",{type:"number","onUpdate:modelValue":l=>o.original_price=l,style:{"max-width":"70%",width:"70%"}},null,8,I),[[b,o.original_price]])]),n("td",null,[c(n("input",{type:"checkbox","onUpdate:modelValue":l=>o.lock=l},null,8,T),[[x,o.lock]])]),n("td",j,[n("span",{onClick:l=>r.removebook(o.guid),style:{position:"absolute",right:"0",top:"5px",cursor:"pointer",color:"red"}},"×",8,B)])]))),128))]),F,n("button",{onClick:e[0]||(e[0]=(...o)=>r.addbook&&r.addbook(...o))},"添加"),m("      "),n("button",{onClick:e[1]||(e[1]=(...o)=>r.search&&r.search(...o))},"暂存"),m("      "),n("button",{onClick:e[2]||(e[2]=(...o)=>r.clear&&r.clear(...o))},"清空"),O,n("div",null,[D,X,n("div",null,[n("label",G,[c(n("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=o=>i.evr=o)},null,512),[[x,i.evr]]),n("div",R,[m(" 每满 "),c(n("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=o=>i.evrV.max=o)},null,512),[[b,i.evrV.max]]),m(" 减 "),c(n("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=o=>i.evrV.dis=o)},null,512),[[b,i.evrV.dis]])])])]),n("div",null,[(h(!0),a(_,null,k(i.options,o=>(h(),a("label",{style:{display:"flex","align-items":"center"},key:o.guid},[c(n("input",{type:"checkbox","onUpdate:modelValue":p=>o.checked=p},null,8,J),[[x,o.checked]]),n("div",Z,[m(" 满 "),c(n("input",{type:"number","onUpdate:modelValue":p=>o.max=p},null,8,q),[[b,o.max]]),m(" 减 "),c(n("input",{type:"number","onUpdate:modelValue":p=>o.dis=p},null,8,z),[[b,o.dis]])])]))),128))])]),H,L,m(" 凑单金额 "),c(n("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=o=>i.curMoney=o)},null,512),[[b,i.curMoney]]),m(" 显示 "),c(n("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=o=>i.curNum=o)},null,512),[[b,i.curNum]]),m(" 个结果 "),n("button",{onClick:e[8]||(e[8]=(...o)=>r.getCombo&&r.getCombo(...o))},"计算凑单组合"),K,P,Q,n("div",null,[(h(!0),a(_,null,k(i.combo,(o,p)=>(h(),a("ul",{key:p},[n("li",null,"组合"+f(p+1)+"：",1),(h(!0),a(_,null,k(o.items,l=>(h(),a("li",{key:l}," [优惠后"+f(l.total)+"元，折扣率"+f(l.pr)+"%] 【"+f(l.title)+"】 ",1))),128)),n("li",null,"总价：[优惠后"+f(o.prTotal)+"元] 原价 "+f(o.money)+" 元",1)]))),128))])])}const $=U(A,[["render",W]]);export{$ as default};
