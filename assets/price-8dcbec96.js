import{_ as C,o as h,c as m,a as o,F as f,r as k,d as a,w as c,e as v,v as b,t as _}from"./index-317b67b5.js";function g(){function t(){return((1+Math.random())*65536|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}const U={data(){return{message:"",books:[{guid:g(),url:"https://u.dangdang.com/qDztD",pid:"",title:"三岛由纪夫套装",price:200,original_price:300,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/m5xfH",pid:"",title:"关于女儿",price:30,original_price:49,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/XmZEC",pid:"",title:"诅咒兔（与诺奖得主托卡尔丘克一同入围2022年国际布克奖！）",price:30,original_price:60,pr:"",total:void 0},{guid:g(),url:"https://u.dangdang.com/XmZEC",pid:"",title:"翦商",price:49,original_price:99,pr:"",total:void 0}],options:[{guid:g(),max:300,dis:50,checked:!1},{guid:g(),max:200,dis:30,checked:!1}],evr:!0,evrV:{max:100,dis:50},curMoney:300,curNum:5,combo:[]}},computed:{booksTotal(){return this.books.length?this.books.reduce((t,e)=>t+e.price,0):0},maxValue(){let t=this.options.filter(i=>i.checked===!0),e,p,s;return t.length?(e=this.booksTotal,p=t.reduce((i,u)=>e<u.max?0:i+u.dis,0)):(e=this.booksTotal,p=0),s=this.evr?Math.floor(e/this.evrV.max)*this.evrV.dis:0,{max:e,sum:p,evrsum:s,total:e-p-s}}},methods:{addbook(){this.books.push({guid:g(),url:"",title:"",price:"",original_price:"",pr:""})},removebook(t){var e=confirm("你确定要删除吗？");e&&(this.books=this.books.filter(p=>p.guid!=t))},clear(){this.books=[]},swapArrayElements(t,e,p){if(e<0||e>=t.length||p<0||p>=t.length)return;const s=t[e];t[e]=t[p],t[p]=s},search(){localStorage.setItem("books",JSON.stringify(this.books))},getCombo(){let t=this.findCombinations(this.books.map(e=>(e.money=+e.price,e.name=e.title,e)),this.curMoney,this.curNum);console.log(t),this.calcAll(),this.combo=t.map(e=>{let p=this.filterObjectsById(this.books,e.guid);return{items:p,prTotal:p.length?p.reduce((s,i)=>s+ +i.total,0).toFixed(2):0,money:e.money}})},filterObjectsById(t,e){return t.filter(p=>e.includes(p.guid))},findCombinations(t,e,p=5){let s=[],i=[];const u=(n,r)=>{if(!(r>e+50||i.length>p)){if(r>e&&r<=e+50){s.push({guid:[...i],money:r});return}for(let l=n;l<t.length;l++)i.includes(t[l].guid)||(i.push(t[l].guid),u(l+1,r+t[l].money),i.pop())}};return u(0,0),s.sort((n,r)=>{const l=Math.abs(n.money-e),d=Math.abs(r.money-e);return l-d}),s.splice(0,p)},findCombinations2(t,e,p=5){const s=new Array(t.length+1);for(let l=0;l<=t.length;l++)s[l]=new Array(e+1).fill(Number.MAX_SAFE_INTEGER);s[0][0]=0;const i=new Array(t.length+1);for(let l=0;l<=t.length;l++)i[l]=new Array(e+1).fill(-1);for(let l=1;l<=t.length;l++)for(let d=0;d<=e;d++)d>=t[l-1].money&&s[l-1][d-t[l-1].money]!==Number.MAX_SAFE_INTEGER&&s[l-1][d-t[l-1].money]+t[l-1].money-d<s[l][d]-e&&(s[l][d]=s[l-1][d-t[l-1].money]+t[l-1].money,i[l][d]=l-1),s[l-1][d]!==Number.MAX_SAFE_INTEGER&&s[l-1][d]-d<s[l][d]-e&&(s[l][d]=s[l-1][d],i[l][d]=i[l-1][d]);let u=e;const n=[],r=new Set;for(let l=0;l<p&&i[t.length][u]!==-1;l++){const d=[];let y=i[t.length][u];for(;y>=0;)d.push(t[y].guid),u-=t[y].money,y=i[y][u];const x=d.join(",");r.has(x)||(r.add(x),n.push({guid:[...d].reverse(),name:d.map(V=>t.find(w=>w.guid===V).name).join("#"),money:s[t.length][e]-u})),u=s[t.length][e]-u}return n},calcAll(){this.books.map(t=>{let e=this.maxValue.total/this.maxValue.max*t.price;t.total=e.toFixed(2),t.pr=(t.total/t.original_price).toFixed(2)*100})}},mounted(){localStorage.getItem("books")&&(this.books=JSON.parse(localStorage.getItem("books")))}},A=o("div",null," 一键抄作业：活动开始前手动录入购物车书名和价格，输入凑单金额，自动计算出符合的凑单组合，然后照着抄吧。 ",-1),E=o("hr",null,null,-1),N=o("tr",null,[o("td",{style:{width:"200px"}},"书名"),o("td",{style:{width:"100px"}},"现价"),o("td",{style:{width:"100px"}},"原价"),o("td",{style:{width:"100px"}},"操作")],-1),M=["onUpdate:modelValue"],S=["onUpdate:modelValue"],T=["onUpdate:modelValue"],F=["onClick"],I=["onClick"],j={style:{position:"relative"}},B=["onClick"],D=o("br",null,null,-1),X=o("hr",null,null,-1),O=o("div",null,"折扣选择",-1),G=o("br",null,null,-1),R={style:{display:"flex","align-items":"center"}},J={style:{width:"300px","text-align":"right"}},Z=["onUpdate:modelValue"],q={style:{width:"300px","text-align":"right"}},z=["onUpdate:modelValue"],H=["onUpdate:modelValue"],L=o("hr",null,null,-1),K=o("br",null,null,-1),P=o("br",null,null,-1),Q=o("strong",null,"备注：目前算法按排列顺序设置优先级，尽量把最想要的书放前面",-1),W=o("hr",null,null,-1);function Y(t,e,p,s,i,u){return h(),m("div",null,[A,E,o("table",null,[N,(h(!0),m(f,null,k(i.books,(n,r)=>(h(),m("tr",{key:n.guid},[o("td",null,[c(o("input",{type:"text","onUpdate:modelValue":l=>n.title=l,style:{"max-width":"90%",width:"90%"}},null,8,M),[[b,n.title]])]),o("td",null,[c(o("input",{type:"number","onUpdate:modelValue":l=>n.price=l,style:{"max-width":"70%",width:"70%"}},null,8,S),[[b,n.price]])]),o("td",null,[c(o("input",{type:"number","onUpdate:modelValue":l=>n.original_price=l,style:{"max-width":"70%",width:"70%"}},null,8,T),[[b,n.original_price]])]),o("td",null,[o("button",{onClick:l=>u.swapArrayElements(i.books,r,r-1)}," 上移 ",8,F),o("button",{onClick:l=>u.swapArrayElements(i.books,r,r+1)}," 下移 ",8,I)]),o("td",j,[o("span",{onClick:l=>u.removebook(n.guid),style:{position:"absolute",right:"0",top:"5px",cursor:"pointer",color:"red"}},"×",8,B)])]))),128))]),D,o("button",{onClick:e[0]||(e[0]=(...n)=>u.addbook&&u.addbook(...n))},"添加"),a("      "),o("button",{onClick:e[1]||(e[1]=(...n)=>u.search&&u.search(...n))},"暂存"),a("      "),o("button",{onClick:e[2]||(e[2]=(...n)=>u.clear&&u.clear(...n))},"清空"),X,o("div",null,[O,G,o("div",null,[o("label",R,[c(o("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=n=>i.evr=n)},null,512),[[v,i.evr]]),o("div",J,[a(" 每满 "),c(o("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=n=>i.evrV.max=n)},null,512),[[b,i.evrV.max]]),a(" 减 "),c(o("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=n=>i.evrV.dis=n)},null,512),[[b,i.evrV.dis]])])])]),o("div",null,[(h(!0),m(f,null,k(i.options,n=>(h(),m("label",{style:{display:"flex","align-items":"center"},key:n.guid},[c(o("input",{type:"checkbox","onUpdate:modelValue":r=>n.checked=r},null,8,Z),[[v,n.checked]]),o("div",q,[a(" 满 "),c(o("input",{type:"number","onUpdate:modelValue":r=>n.max=r},null,8,z),[[b,n.max]]),a(" 减 "),c(o("input",{type:"number","onUpdate:modelValue":r=>n.dis=r},null,8,H),[[b,n.dis]])])]))),128))])]),L,K,a(" 凑单金额 "),c(o("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=n=>i.curMoney=n)},null,512),[[b,i.curMoney]]),a(" 显示 "),c(o("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=n=>i.curNum=n)},null,512),[[b,i.curNum]]),a(" 个结果 "),o("button",{onClick:e[8]||(e[8]=(...n)=>u.getCombo&&u.getCombo(...n))},"计算凑单组合"),P,Q,W,o("div",null,[(h(!0),m(f,null,k(i.combo,(n,r)=>(h(),m("ul",{key:r},[o("li",null,"组合"+_(r+1)+"：",1),(h(!0),m(f,null,k(n.items,l=>(h(),m("li",{key:l}," [优惠后"+_(l.total)+"元，折扣率"+_(l.pr)+"%] 【"+_(l.title)+"】 ",1))),128)),o("li",null,"总价：[优惠后"+_(n.prTotal)+"元] 原价 "+_(n.money)+" 元",1)]))),128))])])}const ee=C(U,[["render",Y]]);export{ee as default};
